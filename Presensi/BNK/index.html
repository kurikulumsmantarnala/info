<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Presensi Pelatih BNK</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Plus Jakarta Sans', sans-serif;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 50%, #1e3a5f 100%);
    }
    
    .card-shadow {
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
    }
    
    .input-focus:focus {
      box-shadow: 0 0 0 3px rgba(45, 90, 135, 0.3);
    }
    
    .btn-gradient {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    }
    
    .btn-gradient:hover {
      background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
    }
    
    .camera-container {
      background: linear-gradient(145deg, #0f172a, #1e293b);
    }
    
    @keyframes pulse-ring {
      0% { transform: scale(0.95); opacity: 1; }
      50% { transform: scale(1); opacity: 0.8; }
      100% { transform: scale(0.95); opacity: 1; }
    }
    
    .animate-pulse-ring {
      animation: pulse-ring 2s ease-in-out infinite;
    }
    
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .animate-slide-up {
      animation: slideUp 0.5s ease-out forwards;
    }
    
    .toast {
      animation: slideUp 0.3s ease-out;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-slate-100 overflow-auto">
  <div id="app-wrapper" class="w-full min-h-full flex flex-col"><!-- Header -->
   <header class="gradient-bg text-white py-4 px-4 shadow-lg">
    <div class="max-w-2xl mx-auto flex items-center gap-4"><img src="https://kurikulumsmantarnala.github.io/info/smantar.png" alt="Logo SMA Negeri Taruna Nala" class="w-16 h-16 object-contain bg-white rounded-full p-1 shadow-md" loading="lazy" onerror="console.error('Image failed to load:', this.src); this.style.background='linear-gradient(135deg, #f59e0b, #d97706)'; this.alt='Logo';">
     <div class="flex-1">
      <h1 id="app-title" class="text-lg md:text-xl font-bold leading-tight">Presensi Pengajar BNK SMA Negeri Taruna Nala Jawa Timur</h1>
      <p class="text-amber-300 text-sm mt-1 font-medium">Sistem Pencatatan Kehadiran Digital</p>
     </div>
    </div>
   </header><!-- Main Content -->
   <main class="flex-1 px-4 py-6">
    <div class="max-w-2xl mx-auto">
     <form id="attendance-form" class="bg-white rounded-2xl card-shadow p-6 md:p-8 animate-slide-up">
      <div class="flex items-center gap-3 mb-6 pb-4 border-b border-slate-200">
       <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-900 to-blue-700 flex items-center justify-center">
        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
        </svg>
       </div>
       <div>
        <h2 class="text-lg font-bold text-slate-800">Form Presensi</h2>
        <p class="text-sm text-slate-500">Isi data kehadiran Anda</p>
       </div>


</div>
<!-- Nama Mapel -->
<div class="mb-5">
  <label for="nama-ekskul" class="block text-sm font-semibold text-slate-700 mb-2">
    <span class="flex items-center gap-2">
      <svg class="w-4 h-4 text-blue-800" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
      </svg>
      Nama Mapel
    </span>
  </label>

  <select id="nama-ekskul" name="nama-ekskul" required
    class="w-full px-4 py-3 rounded-xl border-2 border-slate-200 input-focus focus:border-blue-800 focus:outline-none transition-all duration-200 text-slate-800 bg-white">
    <option value="">Pilih Mapel</option>
    <option value="Renang">Renang</option>
    <option value="BDM">Bela Diri Militer</option>
  </select>
</div>

<!-- Nama Pelatih -->
<div class="mb-5">
  <label class="block text-sm font-semibold text-slate-700 mb-2">
    <span class="flex items-center gap-2">
      <svg class="w-4 h-4 text-blue-800" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
      </svg>
      Nama Pelatih
    </span>
  </label>

  <div id="nama-pelatih"
       class="space-y-2 w-full px-4 py-3 rounded-xl border-2 border-slate-200 bg-white text-slate-800">
    <span class="text-slate-400 text-sm">Nama Pelatih (Pilih mapel dahulu)</span>
  </div>
</div>

<script>
  const mapelSelect = document.getElementById("nama-ekskul");
  const pelatihContainer = document.getElementById("nama-pelatih");

  const dataPelatih = {
    "Renang": [
      "Serka Bah Susanto",
      "Sertu Ttu Joni Endro",
      "Kopka Jas Sukendar"
    ],
    "BDM": [
      "Letda mar (pur) Suwandi",
      "Drs. Basuki Irianto M.Pd."
    ]
  };

  mapelSelect.addEventListener("change", function () {
    const pilihan = this.value;
    pelatihContainer.innerHTML = "";

    if (!dataPelatih[pilihan]) {
      pelatihContainer.innerHTML =
        `<span class="text-slate-400 text-sm">Nama Pelatih (Pilih mapel dahulu)</span>`;
      return;
    }

    dataPelatih[pilihan].forEach(nama => {
      pelatihContainer.innerHTML += `
        <label class="flex items-center gap-2">
          <input type="checkbox"
                 name="nama-pelatih[]"
                 value="${nama}"
                 class="w-4 h-4 text-blue-800 border-gray-300 rounded">
          <span>${nama}</span>
        </label>
      `;
    });
  });
</script>

	



      


      <!-- Tanggal -->
      <div class="mb-5"><label for="tanggal" class="block text-sm font-semibold text-slate-700 mb-2"> <span class="flex items-center gap-2">
         <svg class="w-4 h-4 text-blue-800" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
         </svg> Tanggal </span> </label> <input type="date" id="tanggal" name="tanggal" required class="w-full px-4 py-3 rounded-xl border-2 border-slate-200 input-focus focus:border-blue-800 focus:outline-none transition-all duration-200 text-slate-800">
      </div><!-- Materi -->
      <div class="mb-5"><label for="materi" class="block text-sm font-semibold text-slate-700 mb-2"> <span class="flex items-center gap-2">
         <svg class="w-4 h-4 text-blue-800" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
         </svg> Materi yang Disampaikan </span> </label> <textarea id="materi" name="materi" required rows="3" placeholder="Jelaskan materi yang telah disampaikan" class="w-full px-4 py-3 rounded-xl border-2 border-slate-200 input-focus focus:border-blue-800 focus:outline-none transition-all duration-200 text-slate-800 placeholder-slate-400 resize-none"></textarea>
      </div>

<!-- Foto Section -->
      <div class="mb-6"><label class="block text-sm font-semibold text-slate-700 mb-2"> <span class="flex items-center gap-2">
         <svg class="w-4 h-4 text-blue-800" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" /> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
         </svg> Foto Kegiatan </span> </label> <!-- Camera Preview / Photo Preview -->
       <div id="camera-section" class="camera-container rounded-xl overflow-hidden mb-3">
        <div id="camera-placeholder" class="aspect-video flex flex-col items-center justify-center text-slate-400 p-6">
         <div class="w-16 h-16 rounded-full bg-slate-700 flex items-center justify-center mb-3 animate-pulse-ring">
          <svg class="w-8 h-8 text-slate-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" /> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>
         </div>
         <p class="text-sm font-medium">Klik tombol di bawah untuk mengambil foto</p>
        </div>
        <video id="camera-preview" class="w-full aspect-video object-cover hidden"></video><img id="photo-preview" class="w-full aspect-video object-cover hidden" alt="Preview foto">
       </div><!-- Camera Controls -->
       <div class="flex flex-wrap gap-2"><button type="button" id="btn-start-camera" class="flex-1 min-w-[140px] flex items-center justify-center gap-2 px-4 py-3 bg-blue-900 hover:bg-blue-800 text-white rounded-xl font-semibold transition-all duration-200 shadow-md hover:shadow-lg">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
         </svg><span>Buka Kamera</span> </button> <button type="button" id="btn-upload-file" class="flex-1 min-w-[140px] flex items-center justify-center gap-2 px-4 py-3 bg-green-700 hover:bg-green-600 text-white rounded-xl font-semibold transition-all duration-200 shadow-md hover:shadow-lg">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
         </svg>

<span>Upload Foto</span> </button> <button type="button" id="btn-switch-camera" class="px-4 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-xl font-semibold transition-all duration-200 shadow-md hover:shadow-lg hidden">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
         </svg></button> <button type="button" id="btn-capture" class="flex-1 min-w-[140px] flex items-center justify-center gap-2 px-4 py-3 btn-gradient text-white rounded-xl font-semibold transition-all duration-200 shadow-md hover:shadow-lg hidden">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" /> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
         </svg><span>Ambil Foto</span> </button> <button type="button" id="btn-retake" class="flex-1 min-w-[140px] flex items-center justify-center gap-2 px-4 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-xl font-semibold transition-all duration-200 shadow-md hover:shadow-lg hidden">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
         </svg><span>Ulangi</span> </button>
       </div><input type="file" id="file-input" accept="image/*" class="hidden"> <input type="hidden" id="foto-data" name="foto-data"></div>



<!-- Submit Button --> <button type="submit" id="btn-submit" class="w-full py-4 btn-gradient text-white rounded-xl font-bold text-lg transition-all duration-200 shadow-lg hover:shadow-xl flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
       </svg><span id="btn-submit-text">Kirim Presensi</span> </button>
     </form>
    </div>
   </main><!-- Footer -->
   <footer class="gradient-bg text-white py-4 px-4 mt-auto">
    <div class="max-w-2xl mx-auto text-center">
     <p id="footer-text" class="text-sm text-slate-300">Hak Cipta © SMA Negeri Taruna Nala Jawa Timur 2026</p>
    </div>
   </footer><!-- Toast Notification -->
   <div id="toast" class="fixed top-4 left-4 right-4 md:left-auto md:right-4 md:w-96 bg-white rounded-xl shadow-2xl p-4 transform translate-y-[-150%] transition-transform duration-300 z-50 hidden">
    <div class="flex items-start gap-3">
     <div id="toast-icon" class="w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0">
      <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
      </svg>
     </div>
     <div class="flex-1">
      <p id="toast-title" class="font-bold text-slate-800">Berhasil!</p>
      <p id="toast-message" class="text-sm text-slate-600">Presensi Anda telah tersimpan.</p>
     </div><button id="toast-close" class="text-slate-400 hover:text-slate-600 transition-colors">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
   </div>
  </div>
  <canvas id="photo-canvas" class="hidden"></canvas>
  <script>
    // Configuration
    const defaultConfig = {
      app_title: 'Presensi Pelatih Ekskul SMA Negeri Taruna Nala Jawa Timur',
      footer_text: 'Hak Cipta © SMA Negeri Taruna Nala Jawa Timur 2026'
    };

    // State
    let currentStream = null;
    let facingMode = 'environment';
    let photoData = null;

    // DOM Elements
    const form = document.getElementById('attendance-form');
    const cameraPlaceholder = document.getElementById('camera-placeholder');
    const cameraPreview = document.getElementById('camera-preview');
    const photoPreview = document.getElementById('photo-preview');
    const btnStartCamera = document.getElementById('btn-start-camera');
    const btnUploadFile = document.getElementById('btn-upload-file');
    const btnSwitchCamera = document.getElementById('btn-switch-camera');
    const btnCapture = document.getElementById('btn-capture');
    const btnRetake = document.getElementById('btn-retake');
    const fileInput = document.getElementById('file-input');
    const fotoDataInput = document.getElementById('foto-data');
    const btnSubmit = document.getElementById('btn-submit');
    const btnSubmitText = document.getElementById('btn-submit-text');
    const photoCanvas = document.getElementById('photo-canvas');

    // Set default date to today
    document.getElementById('tanggal').valueAsDate = new Date();

    // Auto-request camera permission on page load
    async function requestCameraPermission() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        // Stop immediately after getting permission
        stream.getTracks().forEach(track => track.stop());
        console.log('Camera permission granted');
      } catch (error) {
        console.error('Camera permission error:', error);
      }
    }

    // Request camera permission when page loads
    requestCameraPermission();

    // Camera Functions
    async function startCamera() {
      try {
        if (currentStream) {
          stopCamera();
        }

        // Show loading message
        showToast('info', 'Meminta Izin Kamera', 'Mohon izinkan akses kamera pada popup browser Anda.');

        const constraints = {
          video: {
            facingMode: facingMode,
            width: { ideal: 1280 },
            height: { ideal: 720 }
          }
        };

        currentStream = await navigator.mediaDevices.getUserMedia(constraints);
        cameraPreview.srcObject = currentStream;
        await cameraPreview.play();

        cameraPlaceholder.classList.add('hidden');
        cameraPreview.classList.remove('hidden');
        photoPreview.classList.add('hidden');
        
        btnStartCamera.classList.add('hidden');
        btnSwitchCamera.classList.remove('hidden');
        btnCapture.classList.remove('hidden');
        btnRetake.classList.add('hidden');

        hideToast();

      } catch (error) {
        console.error('Camera error:', error);
        let errorMessage = 'Tidak dapat mengakses kamera.';
        
        if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
          errorMessage = 'Izin kamera ditolak. Silakan izinkan akses kamera di pengaturan browser Anda dan coba lagi.';
        } else if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {
          errorMessage = 'Kamera tidak ditemukan. Pastikan perangkat Anda memiliki kamera.';
        } else if (error.name === 'NotReadableError' || error.name === 'TrackStartError') {
          errorMessage = 'Kamera sedang digunakan aplikasi lain. Tutup aplikasi lain dan coba lagi.';
        }
        
        showToast('error', 'Gagal Mengakses Kamera', errorMessage);
      }
    }

    function stopCamera() {
      if (currentStream) {
        currentStream.getTracks().forEach(track => track.stop());
        currentStream = null;
      }
    }

    function switchCamera() {
      facingMode = facingMode === 'environment' ? 'user' : 'environment';
      startCamera();
    }

    function capturePhoto() {
  const canvas = photoCanvas;
  const video = cameraPreview;
  const ctx = canvas.getContext('2d');

  // ukuran hasil foto (landscape, sesuai preview)
  const outputWidth = 1280;
  const outputHeight = 720;

  canvas.width = outputWidth;
  canvas.height = outputHeight;

  // ukuran asli video dari kamera
  const videoWidth = video.videoWidth;
  const videoHeight = video.videoHeight;

  const videoRatio = videoWidth / videoHeight;
  const canvasRatio = outputWidth / outputHeight;

  let sx, sy, sw, sh;

  // CENTER CROP
  if (videoRatio > canvasRatio) {
    // video terlalu lebar → potong kiri kanan
    sh = videoHeight;
    sw = videoHeight * canvasRatio;
    sx = (videoWidth - sw) / 2;
    sy = 0;
  } else {
    // video terlalu tinggi (POTRAIT) → potong atas bawah
    sw = videoWidth;
    sh = videoWidth / canvasRatio;
    sx = 0;
    sy = (videoHeight - sh) / 2;
  }

  ctx.drawImage(
    video,
    sx, sy, sw, sh,
    0, 0, outputWidth, outputHeight
  );

  photoData = canvas.toDataURL('image/jpeg', 0.8);
  fotoDataInput.value = photoData;

  photoPreview.src = photoData;

  stopCamera();

  cameraPreview.classList.add('hidden');
  photoPreview.classList.remove('hidden');

  btnCapture.classList.add('hidden');
  btnSwitchCamera.classList.add('hidden');
  btnRetake.classList.remove('hidden');
}




    function retakePhoto() {
      photoData = null;
      fotoDataInput.value = '';
      photoPreview.src = '';
      startCamera();
    }

    // Upload File Functions
    function openFileDialog() {
      fileInput.click();
    }

    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (!file) return;

      // Validate file type
      if (!file.type.startsWith('image/')) {
        showToast('error', 'File Tidak Valid', 'Silakan pilih file gambar (JPG, PNG, dll).');
        return;
      }
      // Validate file size (max 5MB)
      const maxSize = 5 * 1024 * 1024; // 5MB
      if (file.size > maxSize) {
        showToast('error', 'File Terlalu Besar', 'Ukuran file maksimal 5MB. Silakan pilih foto yang lebih kecil.');
        return;
      }

const reader = new FileReader();
      reader.onload = function(e) {
        photoData = e.target.result;
        fotoDataInput.value = photoData;
        photoPreview.src = photoData;

        // Stop camera if running
        stopCamera();

        // Update UI
        cameraPlaceholder.classList.add('hidden');
        cameraPreview.classList.add('hidden');
        photoPreview.classList.remove('hidden');

        btnStartCamera.classList.add('hidden');
        btnUploadFile.classList.add('hidden');
        btnSwitchCamera.classList.add('hidden');
        btnCapture.classList.add('hidden');
        btnRetake.classList.remove('hidden');

        showToast('success', 'Foto Berhasil Dipilih', 'Foto Anda siap untuk digunakan.');
      };

      reader.onerror = function() {
        showToast('error', 'Gagal Membaca File', 'Terjadi kesalahan saat membaca file. Silakan coba lagi.');
      };

      reader.readAsDataURL(file);
    }


    function resetForm() {
      form.reset();
      document.getElementById('tanggal').valueAsDate = new Date();
      
      stopCamera();
      photoData = null;
      fotoDataInput.value = '';
      
      cameraPlaceholder.classList.remove('hidden');
      cameraPreview.classList.add('hidden');
      photoPreview.classList.add('hidden');
      
      btnStartCamera.classList.remove('hidden');
      btnSwitchCamera.classList.add('hidden');
      btnCapture.classList.add('hidden');
      btnRetake.classList.add('hidden');
    }

    // Toast Functions
    function showToast(type, title, message) {
      const toast = document.getElementById('toast');
      const toastIcon = document.getElementById('toast-icon');
      const toastTitle = document.getElementById('toast-title');
      const toastMessage = document.getElementById('toast-message');

      toastTitle.textContent = title;
      toastMessage.textContent = message;

      if (type === 'success') {
        toastIcon.className = 'w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 bg-green-500';
        toastIcon.innerHTML = '<svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>';
      } else if (type === 'info') {
        toastIcon.className = 'w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 bg-blue-500';
        toastIcon.innerHTML = '<svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';
      } else {
        toastIcon.className = 'w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 bg-red-500';
        toastIcon.innerHTML = '<svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>';
      }

      toast.classList.remove('hidden');
      setTimeout(() => {
        toast.style.transform = 'translateY(0)';
      }, 10);

      setTimeout(() => {
        hideToast();
      }, 5000);
    }

    function hideToast() {
      const toast = document.getElementById('toast');
      toast.style.transform = 'translateY(-150%)';
      setTimeout(() => {
        toast.classList.add('hidden');
      }, 300);
    }

    // Form Submission
    async function handleSubmit(e) {
      e.preventDefault();

      if (!photoData) {
        showToast('error', 'Foto Diperlukan', 'Silakan ambil foto kegiatan terlebih dahulu.');
        return;
      }
      const pelatihChecked = document.querySelectorAll('input[name="nama-pelatih[]"]:checked');
      const namaPelatih = Array.from(pelatihChecked).map(cb => cb.value);
      const namaEkskul = document.getElementById('nama-ekskul').value;
      const tanggal = document.getElementById('tanggal').value;
      const materi = document.getElementById('materi').value.trim();

      if (namaPelatih.length === 0 || !namaEkskul || !tanggal || !materi) {
        showToast('error', 'Data Tidak Lengkap', 'Mohon lengkapi semua field yang diperlukan.');
        return;
      }

      // Create timestamp
      const now = new Date();
      const timestamp = now.toLocaleString('id-ID', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      });

      // Prepare data
      const formData = {
      timestamp: timestamp,
      namaPelatih: namaPelatih.join(', '), // jadi string rapi
      namaEkskul: namaEkskul,
      tanggal: tanggal,
      materi: materi,
     foto: photoData
	};


      // Show loading state
      btnSubmit.disabled = true;
      btnSubmitText.textContent = 'Mengirim...';

      try {
        const response = await fetch('https://script.google.com/macros/s/AKfycbxtydVZMrr9G6g6oCmmMHNO51kMGXxQOIQKRuc4uinzDAZJkAOsCu3ojpJKPJ5L8ydl/exec', {
          method: 'POST',
          mode: 'no-cors',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        });

        // Since mode is no-cors, we can't read the response
        // Assume success if no error thrown
        showToast('success', 'Berhasil!', 'Presensi Anda telah berhasil dikirim.');
        resetForm();

      } catch (error) {
        console.error('Submit error:', error);
        showToast('error', 'Gagal Mengirim', 'Terjadi kesalahan. Silakan coba lagi.');
      } finally {
        btnSubmit.disabled = false;
        btnSubmitText.textContent = 'Kirim Presensi';
      }
    }

    // Event Listeners
    btnStartCamera.addEventListener('click', startCamera);
    btnUploadFile.addEventListener('click', openFileDialog);
    btnSwitchCamera.addEventListener('click', switchCamera);
    btnCapture.addEventListener('click', capturePhoto);
    btnRetake.addEventListener('click', retakePhoto);
    fileInput.addEventListener('change', handleFileSelect);
    form.addEventListener('submit', handleSubmit);
    document.getElementById('toast-close').addEventListener('click', hideToast);

    // Element SDK Integration
    async function onConfigChange(config) {
      const appTitle = document.getElementById('app-title');
      const footerText = document.getElementById('footer-text');
      
      if (appTitle) {
        appTitle.textContent = config.app_title || defaultConfig.app_title;
      }
      if (footerText) {
        footerText.textContent = config.footer_text || defaultConfig.footer_text;
      }
    }

    function mapToCapabilities(config) {
      return {
        recolorables: [],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ['app_title', config.app_title || defaultConfig.app_title],
        ['footer_text', config.footer_text || defaultConfig.footer_text]
      ]);
    }

    // Initialize Element SDK
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c2c7219f060a136',t:'MTc2OTIyNTM1OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
